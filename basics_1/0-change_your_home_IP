#!/usr/bin/env bash
# This script modifies the /etc/hosts file to change the IP resolution
# for 'localhost' and 'facebook.com'.
# This operation requires root privileges (sudo) to run successfully.

HOSTS_FILE="/etc/hosts"
NEW_LOCALHOST_IP="127.0.0.2"
NEW_LOCALHOST_NAME="localhost"
NEW_FACEBOOK_IP="8.8.8.8"
NEW_FACEBOOK_NAME="facebook.com"

# --- 1. Modify localhost resolution to 127.0.0.2 ---

# Backup the original hosts file before making any changes.
cp "$HOSTS_FILE" "${HOSTS_FILE}.bak"

# 1.1. Remove 'localhost' association from the 127.0.0.1 loopback address.
# This ensures that 'localhost' resolves to 127.0.0.2, which we will add next.
# It uses sed to substitute (remove) the word 'localhost' from lines starting with 127.0.0.1.
sed -i "/127\.0\.0\.1/ s/\(\<localhost\>\)\(\s\+\)\?//" "$HOSTS_FILE"

# 1.2. Add the new localhost entry: 127.0.0.2 localhost.
# Using -e flag for echo to interpret the tab character \t for clean formatting.
if ! grep -q "^${NEW_LOCALHOST_IP}[[:space:]]\+${NEW_LOCALHOST_NAME}" "$HOSTS_FILE"; then
    echo -e "${NEW_LOCALHOST_IP}\t${NEW_LOCALHOST_NAME}" >> "$HOSTS_FILE"
fi

# --- 2. Modify facebook.com resolution to 8.8.8.8 ---

# 2.1. Delete all existing lines containing 'facebook.com' (regardless of its current IP).
sed -i "/${NEW_FACEBOOK_NAME}/d" "$HOSTS_FILE"

# 2.2. Add the new facebook.com entry: 8.8.8.8 facebook.com.
echo -e "${NEW_FACEBOOK_IP}\t${NEW_FACEBOOK_NAME}" >> "$HOSTS_FILE"

echo "Host resolution updated successfully. (Yorumlar Ä°ngilizce olarak eklendi.)"
echo "Please check 'ping localhost' and 'ping facebook.com'."
